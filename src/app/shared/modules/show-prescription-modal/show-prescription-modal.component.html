<app-loader *ngIf="prescriptionLoader"></app-loader>

<div class="relative" id="printable-section">
  <div
    #printableSection
    *ngIf="!prescriptionLoader"
    class="px-12 pt-12 h-[800px] bg-white relative"
  >
    <!-- Doctor Info -->
    <div class="flex justify-between mb-5">
      <div>
        <h1 class="text-2xl font-semibold">
          Dr. {{ prescriptionInfo.doctorName }}
        </h1>

        <!-- <p class="text-gray-600">General Medicine</p>
                  <p class="text-gray-600">Chamber: 123 Main Street, City <br> Dhaka, Bangladesh </p> -->
      </div>
      <div>
        <img
          class="w-[200px]"
          width="100"
          height="100"
          ngSrc="/assets/SoowGood.png"
          alt=""
        />
      </div>
    </div>

    <!-- Patient Info -->
    <hr />
    <div
      class="mt-2 mb-2 grid grid-cols-1 md:grid-cols-4 print:grid-cols-4 gap-4"
    >
      <div>
        <label class="text-sm text-gray-600">Patient Name</label>
        <p class="font-semibold text-sm">{{ prescriptionInfo.patientName }}</p>
      </div>
      <div>
        <label class="text-sm text-gray-600">Age</label>
        <p class="font-semibold text-sm">
          {{ prescriptionInfo.patientAge }}Years
        </p>
      </div>
      <div>
        <label class="text-sm text-gray-600">Blood Group</label>
        <p class="font-semibold text-sm">
          {{ prescriptionInfo.patientBloodGroup }}
        </p>
      </div>
      <div>
        <label class="text-sm text-gray-600">Date & Time</label>
        <p class="font-semibold text-sm">
          {{ prescriptionInfo.appointmentDate | date }}
        </p>
      </div>
    </div>
    <hr />
    <!-- Additional Information -->
    <div class="grid grid-cols-3 print:grid-cols-3">
      <div class="mb-4 py-4 border-r-[1px] h-full">
        <div class="mt-3 border-b-[1px] pb-3">
          <h2 class="text-[16px] font-Roboto text-primary/90">
            Patient History
          </h2>
          <ul>
            @for (history of prescriptionInfo.prescriptionPatientDiseaseHistory;
            track $index) {
            <li class="pl-2 text-[14px] font-poppins text-primary/90">
              {{ history.diseaseName }}
            </li>
            }@empty {
            <p class="text-[12px] ml-2">No history found!</p>
            }
          </ul>
        </div>
        <div class="mt-3 border-b-[1px] pb-3">
          <h2 class="text-[16px] font-Roboto text-primary/90">
            Additional Info
          </h2>
          @if (prescriptionInfo.patientAdditionalInfo) {
          <p class="pl-2 text-[14px] font-poppins text-primary/90">
            {{ prescriptionInfo.patientAdditionalInfo }}
          </p>
          }@else {
          <p class="text-[12px] ml-2">No additional info found!</p>
          }
        </div>
        <div class="mt-3 border-b-[1px] pb-3">
          <h2 class="text-[16px] font-Roboto text-primary/90">
            Doctor Findings
          </h2>
          <ul>
            @for (findings of prescriptionInfo.prescriptionFindingsObservations;
            track $index) {
            <li class="pl-2 text-[14px] font-poppins text-primary/90">
              {{ findings.observation }}
            </li>
            }@empty {
            <p class="text-[12px] ml-2">No findings found!</p>
            }
          </ul>
        </div>
        <div class="mt-3 border-b-[1px] pb-3">
          <h2 class="text-[16px] font-Roboto text-primary/90">Observation</h2>
          <ul>
            @for (complaints of prescriptionInfo.prescriptionMainComplaints;
            track $index) {
            <li class="pl-2 text-[14px] font-poppins text-primary/90">
              <p class="w-[180px] inline-block">{{ complaints.symptom }}-</p>
              <span class="text-[14px] mr-2"
                >({{ convertToBanglaDuration(complaints.duration) }})</span
              >
            </li>
            }@empty {
            <p class="text-[12px] ml-2">No complaints found!</p>
            }
          </ul>
        </div>
        <div class="mt-3 border-b-[1px] pb-3">
          <h2 class="text-[16px] font-Roboto text-primary/90">
            Test Recommended
          </h2>
          <ul>
            @for (test of prescriptionInfo.prescriptionMedicalCheckups; track
            $index; let count = $count) {
            <li class="pl-2 text-[14px] font-poppins text-primary/90">
              {{ test.testName }}
            </li>
            }@empty {
            <p class="text-[12px] ml-2">No test found!</p>

            }
          </ul>
        </div>
      </div>
      <div class="mb-4 col-span-2 p-4">
        <div class="mt-3">
          <img
            class="w-[25px] h-[25px] opacity-90"
            ngSrc="/assets/rx.png"
            width="100"
            height="100"
            alt="rx"
          />
          <div
            class="mt-3 pl-3 pb-2 border-b-[1px] drug"
            *ngFor="
              let medicine of prescriptionInfo.prescriptionDrugDetails;
              let i = index
            "
          >
            <h1 class="font-Roboto text-[16px] text-primary">
              {{ i + 1 }}. {{ medicine.drugName }}
            </h1>
            <div class="font-Roboto pl-4 py-2 text-[14px] text-primary/80">
              <p class="w-[250px] inline-block">
                {{
                  convertToBanglaText(
                    medicine.drugName,
                    medicine.drugDoseSchedule
                  )
                }}
              </p>

              <span class="ml-5 font-semibold"
                >( {{ convertToBanglaDuration(medicine.duration) }})</span
              >
            </div>
            <!-- <p class="font-Roboto pl-4 text-[14px] text-primary/80">
              {{ medicine.duration }}
            </p> -->
            @if (medicine.instruction !== '') {
            <p class="font-Roboto pl-4 text-[14px] text-primary/80">
              মন্তব্য: {{ medicine.instruction }}
            </p>
            }
          </div>
        </div>
        <div
          class="grid grid-cols-1 mt-5 md:grid-cols-2 print:grid-cols-2 gap-3"
        >
          <div class="mt-3">
            <h2
              class="text-[16px] font-Roboto text-primary/90 border-b-[1px] pb-1"
            >
              Follow up
            </h2>
            <p class="text-[12px] mt-2">
              {{
                prescriptionInfo.followupDate
                  ? (prescriptionInfo.followupDate | date)
                  : "No need to followup"
              }}
            </p>
          </div>
          <!-- <div class="mt-3">
                                    <h2 class="text-[16px] font-semibold font-Roboto text-primary/90">Refer to</h2>
                                     <p>Dr. Sadia sultana</p>
                               </div> -->
          <div class="mt-3">
            <h2
              class="text-[16px] font-Roboto text-primary/90 border-b-[1px] pb-1"
            >
              Doctor Advice
            </h2>
            <p class="text-[12px] mt-2">
              {{
                prescriptionInfo.advice
                  ? prescriptionInfo.advice
                  : "No advice found!"
              }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="absolute bottom-0 h-[50px] w-full bg-gray-300 flex gap-10">
    <button class="btn-primary print:hidden" (click)="pdfSavePrint('print')">
      Print
    </button>
    <button class="btn-primary print:hidden" (click)="pdfSavePrint('save')">
      Save
    </button>
  </div>
</div>
