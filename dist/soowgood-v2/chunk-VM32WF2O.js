import{a as ue}from"./chunk-BSWVXCA6.js";import{d as ee}from"./chunk-PUKYV4E7.js";import{a as de}from"./chunk-7NGZH4SF.js";import{a as se,c as ne,h as ae,j as le,k as me}from"./chunk-Y7H6PHVG.js";import"./chunk-4DRUEFLH.js";import{A as oe,k as ie,s as re,z as E}from"./chunk-GEVSPATW.js";import{a as te}from"./chunk-7LPMGZKA.js";import{B as Q,D as X,E as Z,F as R,c as z,e as F,h as H,i as W,n as Y,r as $,u as J,y as K}from"./chunk-N3UDIXRD.js";import{Bb as N,Ha as b,Ma as u,Qa as j,S as P,Ub as U,Wb as q,X as M,Xa as i,Y as A,Ya as o,Za as f,ca as k,cc as O,fb as S,fc as V,hb as y,tb as l,uc as B,vb as x,vc as G,xc as D,ya as a,za as c}from"./chunk-TXQBTV46.js";import"./chunk-5G567QLT.js";function ge(t,s){t&1&&(i(0,"mat-error",31),l(1," You must enter a valid mobile number. "),o())}function he(t,s){t&1&&(i(0,"mat-error",32),l(1," Mobile number should have exactly 11 digits and follow the Bangladeshi format. "),o())}function ve(t,s){if(t&1&&(i(0,"mat-error"),l(1),o()),t&2){let _=y(),m;a(),x(" ",(m=_.loginForm.get("mobileNo"))==null?null:m.getError("customError")," ")}}function we(t,s){t&1&&(i(0,"mat-error"),l(1," Password is required. "),o())}function _e(t,s){t&1&&(i(0,"mat-error"),l(1," Password must start with an uppercase letter. "),o())}function be(t,s){t&1&&(i(0,"mat-error"),l(1," Password must be at least 6 characters long. "),o())}function Se(t,s){t&1&&(i(0,"mat-error"),l(1," Password must include a special character. "),o())}function ye(t,s){t&1&&(i(0,"mat-error"),l(1," Password must include a number. "),o())}function xe(t,s){if(t&1&&(i(0,"mat-error"),l(1),o()),t&2){let _=y(),m;a(),x(" ",(m=_.loginForm.get("password"))==null?null:m.getError("customError")," ")}}function Fe(t,s){if(t&1&&(i(0,"div",33),f(1,"i",34),l(2),o()),t&2){let _=y();a(2),x(" ",_.errorMessage," ")}}function Ne(t,s){t&1&&(i(0,"div",35)(1,"span"),l(2,"Login"),o(),f(3,"i",36),o())}function Ee(t,s){t&1&&f(0,"span",37)}var pe=t=>({"border-red-500":t}),ce=(()=>{let s=class s{constructor(m,p,e,d,h,v,n,r,g,w){this.authService=m,this.appAuthService=p,this.oAuthService=e,this.doctorProfileService=d,this.PatientProfileService=h,this.fb=v,this._router=n,this.ToasterService=r,this.NormalAuth=g,this.UserAccountsService=w,this.defaultAuth={mobileNo:"",password:""},this.formSubmitted=!1,this.errorMessage="",this.loginDto={},this.hasError=!1,this.subs=new de,this.isLoading=!1,this.passwordFieldType="password",this.confirmPasswordFieldType="password",this.changePasswordShow=!1,this.resetModalShow=!1,this.resetLoading=!1,this.resetFormSubmitted=!1,this.resetPasswordFieldType="password",this.resetConfPasswordFieldType="password"}ngOnInit(){this.initForm()}get formControl(){return this.loginForm.controls}goToForgotPassword(){this._router.navigate(["/forgot-password"],{queryParams:{redirect:"login"}})}initForm(){this.loginForm=this.fb.group({mobileNo:[this.defaultAuth.mobileNo,[F.required,F.pattern(/(^(\+88|0088)?(01){1}[3456789]{1}(\d){8})$/)]],password:[this.defaultAuth.password,F.required]})}passwordVisibility(m){m==="password"?this.passwordFieldType=this.passwordFieldType==="password"?"text":"password":m==="confirmPassword"&&(this.confirmPasswordFieldType=this.confirmPasswordFieldType==="password"?"text":"password")}onSubmit(){if(this.formSubmitted=!0,!this.loginForm.valid&&!this.loginForm.touched){this.ToasterService.customToast("Please fill in all required fields","warning"),this.isLoading=!1;return}else{if(this.loginForm.invalid){this.isLoading=!1;return}this.formSubmitted=!1,this.isLoading=!0;let m="";this.errorMessage="",this.hasError=!1;let p=this.formControl.mobileNo.value,e=this.formControl.password.value;this.oAuthService.oidc=!1,this.loginDto.userName=p,this.loginDto.email="",this.loginDto.password=e,this.loginDto.rememberMe=!1;try{this.appAuthService.isLoadingSubject.next(!0),this.oAuthService.fetchTokenUsingPasswordFlowAndLoadUserProfile(p,e).then(d=>{if(console.log(d),d&&d?.info?.role!=="Agent"){let v=this.appAuthService.createUserModel(d);var h=p.split("@")[0];this.authService.loginByUserDto(this.loginDto).subscribe(n=>{if(this.loginResponse=n,this.loginResponse.message.includes("User Name Or Password is not correct !")){this.ToasterService.customToast(String(this.loginResponse.message),"warning"),this.isLoading=!1;return}n.success&&n.roleName[0]=="Doctor"?(this.isLoading=!1,this.subs.sink=this.doctorProfileService.getByUserName(n.userName?n.userName:"").subscribe(r=>{let g={identityNumber:r.identityNumber,fullName:r.fullName,bmdcRegNo:r.bmdcRegNo,isActive:r.isActive,userId:r.userId,id:r.id,specialityId:r.specialityId,profileStep:r.profileStep,createFrom:r.createFrom,userType:n.roleName.toString().toLowerCase()};this.NormalAuth.setAuthInfoInLocalStorage(g),r.profileStep==1||r.profileStep==2?m="/signup":m=r.isActive?n.roleName.toString()+"/dashboard":n.roleName.toString()+"/profile-settings/basic-info",this._router.navigate([m.toLowerCase()],{state:{data:r}}).then(()=>{this.ToasterService.customToast(n.message?n.message:" ","success")})},r=>{this.handleProfileError(r)})):n.success&&n.roleName[0]=="Patient"?(this.isLoading=!1,this.subs.sink=this.PatientProfileService.getByUserName(n.userName?n.userName:"").subscribe(r=>{let g={fullName:r.fullName,userId:r.userId,id:r.id,userType:n.roleName.toString().toLowerCase()};this.NormalAuth.setAuthInfoInLocalStorage(g);let w=n.roleName.toString()+"/dashboard";this._router.navigate([w.toLowerCase()],{state:{data:r}}).then(()=>{this.ToasterService.customToast(n.message?n.message:" ","success")})},r=>{this.handleProfileError(r)})):(this.hasError=!0,this.ToasterService.customToast(n.message?n.message:" ","error"),this.isLoading=!1)})}d?.info.role==="Agent"&&(this.hasError=!0,this.isLoading=!1,this.errorMessage="You are a Agent!. Please login from Agent portal.")}).catch(d=>{this.hasError=!0,this.appAuthService.isLoadingSubject.next(!1),this.errorMessage=d.error.error_description||d.error.error,this.isLoading=!1})}catch(d){this.hasError=!0,d.message==="'tokenEndpoint' should not be null"&&(this.errorMessage="Identity server is not running")}}}handleProfileError(m){this.errorMessage="",m.error.error.message==="There is no entity DoctorProfile with id = !"?this.errorMessage="User not found":this.ToasterService.customToast(String(m.error.error.message),"error")}ngOnDestroy(){this.subs.unsubscribe()}};s.\u0275fac=function(p){return new(p||s)(c(E),c(ue),c(ee),c(ie),c(re),c(X),c(B),c(oe),c(te),c(E))},s.\u0275cmp=M({type:s,selectors:[["app-login"]],decls:52,vars:23,consts:[[1,"signup-form"],[1,"signup-form__left"],["ngSrc","/assets/auth/login-auth.webp","width","400","height","400","alt","auth"],[1,"signup-form__right","drop-shadow-soft","relative"],[1,"max-w-lg","relative","min-w-[500px]","mx-auto","mt-10","bg-white","p-8","rounded-xl","shadow","shadow-slate-300"],["width","70","height","70","ngSrc","/assets/auth/ms-icon-310x310.png","alt","icon",1,"w-[100px]","rounded-full","border-2","border-white","h-[100px]","absolute","-top-[60px]","left-1/2","-translate-x-1/2"],[1,"text-4xl","font-semibold","font-Roboto","text-primary","mt-8"],[1,"text-slate-500","mt-2"],[1,"mt-6",3,"formGroup","submit"],[1,"flex","flex-col","space-y-5","mt-10"],["for","mobile"],[1,"font-medium","text-slate-700","pb-2"],[1,"form_input","flex","h-[40px]",3,"ngClass"],["matPrefix","",1,"h-fit","font-Roboto","text-[16px]"],["autocomplete","off","matInput","","maxlength","11","type","tel","formControlName","mobileNo","id","mobileNo","placeholder","018-000-00000","required","","inputmode","numeric",1,"w-full","bg-white","border-none","outline-none","font-Roboto","h-fit","font-semibold","text-[16px]"],["class","text-red-600",4,"ngIf"],["class","text-red-500",4,"ngIf"],[4,"ngIf"],["for","Password"],[1,"form_input","flex","justify-between",3,"ngClass"],["autocomplete","off","formControlName","password","name","password","id","password","placeholder","Password123@*",1,"outline-none","border-none","w-full","bg-white",3,"type"],[1,"cursor-pointer",3,"click"],[1,"flex","flex-col"],["class","p-4 mb-4 text-sm text-yellow-800 rounded-lg bg-yellow-50 font-semibold font-Roboto","role","alert",4,"ngIf"],["type","submit",1,"form_btn","disabled:bg-gray-500","disabled:select-none",3,"disabled"],["class","flex items-center",4,"ngIf"],["class","loading loading-dots loading-md",4,"ngIf"],[1,"text-center"],["routerLink","/signup",1,"text-primary","font-medium","inline-flex","space-x-1","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"text-red-600"],[1,"text-red-500"],["role","alert",1,"p-4","mb-4","text-sm","text-yellow-800","rounded-lg","bg-yellow-50","font-semibold","font-Roboto"],[1,"fa-solid","fa-circle-exclamation","mr-2"],[1,"flex","items-center"],[1,"fa-solid","ml-2","fa-right-to-bracket"],[1,"loading","loading-dots","loading-md"]],template:function(p,e){if(p&1&&(i(0,"div",0)(1,"div",1),f(2,"img",2),o(),i(3,"div",3)(4,"div",4),f(5,"img",5),i(6,"h1",6),l(7," Login "),o(),i(8,"p",7),l(9,"Hi, Welcome to SoowGood \u{1F44B}"),o(),i(10,"form",8),S("submit",function(){return e.onSubmit()}),i(11,"div",9)(12,"label",10)(13,"p",11),l(14,"Mobile Number"),o(),i(15,"div",12)(16,"span",13),l(17,"+88 \xA0"),o(),f(18,"input",14),o(),b(19,ge,2,0,"mat-error",15)(20,he,2,0,"mat-error",16)(21,ve,2,1,"mat-error",17),o(),i(22,"label",18)(23,"p",11),l(24,"Password"),o(),i(25,"div",19),f(26,"input",20),i(27,"span",21),S("click",function(){return e.passwordVisibility("password")}),f(28,"i"),o()(),i(29,"div",22),b(30,we,2,0,"mat-error",17)(31,_e,2,0,"mat-error",17)(32,be,2,0,"mat-error",17)(33,Se,2,0,"mat-error",17)(34,ye,2,0,"mat-error",17)(35,xe,2,1,"mat-error",17),o()(),b(36,Fe,3,1,"div",23),i(37,"button",24),b(38,Ne,4,0,"div",25)(39,Ee,1,0,"span",26),o(),i(40,"p"),l(41," Forgot your password?"),i(42,"strong",21),S("click",function(){return e.goToForgotPassword()}),l(43," Reset now"),o()(),i(44,"p",27),l(45," Don't have an account? "),i(46,"a",28)(47,"span"),l(48,"Sign up "),o(),i(49,"span"),k(),i(50,"svg",29),f(51,"path",30),o()()()()()()()()()),p&2){let d,h,v,n,r,g,w,C,T,I,L;a(10),u("formGroup",e.loginForm),a(5),u("ngClass",N(19,pe,((d=e.loginForm.get("mobileNo"))==null?null:d.invalid)&&((d=e.loginForm.get("mobileNo"))==null?null:d.touched))),a(4),u("ngIf",((h=e.loginForm.get("mobileNo"))==null?null:h.hasError("required"))&&((h=e.loginForm.get("mobileNo"))==null?null:h.touched)),a(),u("ngIf",((v=e.loginForm.get("mobileNo"))==null?null:v.hasError("pattern"))&&((v=e.loginForm.get("mobileNo"))==null?null:v.touched)),a(),u("ngIf",(n=e.loginForm.get("mobileNo"))==null?null:n.hasError("customError")),a(4),u("ngClass",N(21,pe,((r=e.loginForm.get("password"))==null?null:r.invalid)&&((r=e.loginForm.get("password"))==null?null:r.touched))),a(),u("type",e.passwordFieldType),a(2),j(e.passwordFieldType==="password"?"fa fa-eye-slash":"fa fa-eye"),a(2),u("ngIf",e.formSubmitted&&((g=e.loginForm.get("password"))==null?null:g.hasError("required"))),a(),u("ngIf",e.formSubmitted&&((w=e.loginForm.get("password"))==null?null:w.hasError("startsWithUppercase"))),a(),u("ngIf",e.formSubmitted&&((C=e.loginForm.get("password"))==null?null:C.hasError("isAtLeast6Characters"))),a(),u("ngIf",e.formSubmitted&&((T=e.loginForm.get("password"))==null?null:T.hasError("includesSpecialCharacter"))),a(),u("ngIf",e.formSubmitted&&((I=e.loginForm.get("password"))==null?null:I.hasError("includesNumber"))),a(),u("ngIf",(L=e.loginForm.get("password"))==null?null:L.hasError("customError")),a(),u("ngIf",e.errorMessage),a(),u("disabled",e.isLoading||!e.loginForm.dirty||e.loginForm.invalid),a(),u("ngIf",!e.isLoading),a(),u("ngIf",e.isLoading)}},dependencies:[U,q,G,Y,z,H,W,K,Q,$,J,se,ne,le,V],styles:[".signup-form__left[_ngcontent-%COMP%]{width:49.3%;height:100%}.signup-form__left[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}"]});let t=s;return t})();var Ce=[{path:"",component:ce}],Je=(()=>{let s=class s{};s.\u0275fac=function(p){return new(p||s)},s.\u0275mod=A({type:s}),s.\u0275inj=P({imports:[O,D.forChild(Ce),Z,R,ae,me]});let t=s;return t})();export{Je as LoginModule};
