"use strict";(self.webpackChunksoowgood_v2=self.webpackChunksoowgood_v2||[]).push([[336,381],{336:(U,b,n)=>{n.r(b),n.d(b,{LoginModule:()=>E});var m=n(6895),l=n(4006),d=n(6240),u=n(2843),e=n(4650),c=n(5374),S=n(2339),L=n(6084),A=n(1135),T=n(9646),x=n(8746);class Z{setAuth(i){this.authToken=i.authToken,this.refreshToken=i.refreshToken,this.expiresIn=i.expiresIn}}class k extends Z{setUser(i){i&&i.info&&(this.name=i.info.name||"",this.given_name=i.info.given_name||"",this.fullname=i.info.preferred_username||i.info.name,this.email=i.info.email||"",this.email_verified=i.info.email_verified||"False",this.phone_number_verified=i.info.phone_number_verified||"False",this.pic=i.info.pic||"./assets/media/avatars/default.jpg",this.roles=[i.info.role],this.sub=i.info.sub)}}var y=n(210),w=n(2510);let I=(()=>{class o{get currentUserValue(){return this.currentUserSubject.value}set currentUserValue(r){this.currentUserSubject.next(r)}constructor(r,t){this.oAuthService=r,this.router=t,this.subs=new d.Y,this.isLoadingSubject=new A.X(!1),this.currentUserSubject=new A.X(void 0),this.currentUser$=this.currentUserSubject.asObservable(),this.isLoading$=this.isLoadingSubject.asObservable()}getUserByToken(){return this.oAuthService.hasValidAccessToken()?(0,T.of)(this.createUserModel(this.oAuthService.getIdentityClaims())):(0,T.of)()}login(r,t){try{if(this.oAuthService.hasValidAccessToken()||this.oAuthService.hasValidIdToken())return(0,T.of)(this.createUserModel(this.oAuthService.getIdentityClaims()));this.isLoadingSubject.next(!0),this.oAuthService.oidc=!1,this.oAuthService.fetchTokenUsingPasswordFlowAndLoadUserProfile(r,t).then(h=>(h?this.createUserModel(h):this.logout(),(0,T.of)(h))).catch(h=>{console.log(h),this.isLoadingSubject.next(!1)}),(0,x.x)(()=>this.isLoadingSubject.next(!1))}catch(h){throw h}}createUserModel(r){const t=new k;return t.setUser(r),t.setAuth(this.getAuthData()),this.currentUserSubject=new A.X(t),this.currentUserSubject.next(t),t}getAuthData(){return{authToken:this.oAuthService.getAccessToken(),refreshToken:this.oAuthService.getRefreshToken(),expiresIn:this.oAuthService.getAccessTokenExpiration()}}logout(){this.oAuthService.logOut(),this.router.navigate(["/auth/login"])}ngOnDestroy(){this.subs.unsubscribe()}}return o.\u0275fac=function(r){return new(r||o)(e.LFG(y.Ct),e.LFG(w.F0))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var M=n(2381),_=n(629);function P(o,i){1&o&&(e.TgZ(0,"div",22),e.O4$(),e.TgZ(1,"svg",23),e._UZ(2,"path",24),e.qZA(),e.kcU(),e.TgZ(3,"span"),e._uU(4,"Login"),e.qZA()())}function j(o,i){1&o&&e._UZ(0,"span",25)}const N=function(o){return{"border-red-500":o}},O=[{path:"",component:(()=>{class o{constructor(r,t,h,f,g,p,v,s,a){this.authService=r,this.appAuthService=t,this.oAuthService=h,this.doctorProfileService=f,this.PatientProfileService=g,this.fb=p,this._router=v,this.ToasterService=s,this.NormalAuth=a,this.defaultAuth={mobileNo:"",password:""},this.errorMessage="",this.loginDto={},this.hasError=!1,this.subs=new d.Y,this.isLoading=!1,this.appAuthService.currentUserValue&&this._router.navigate(["/landing-page"])}ngOnInit(){this.initForm()}get formControl(){return this.loginForm.controls}initForm(){this.loginForm=this.fb.group({mobileNo:[this.defaultAuth.mobileNo,l.kI.compose([l.kI.required])],password:[this.defaultAuth.password,l.kI.compose([l.kI.required])]})}handleLoginError(r){return this.hasError=!0,"'tokenEndpoint' should not be null"===r.message&&(this.errorMessage="Identity server is not running"),(0,u._)(r)}handleProfileError(r){return(0,u._)(r)}onSubmit(){if(!this.loginForm.valid&&!this.loginForm.touched)return this.ToasterService.customToast("Please filled all required field","warning"),void(this.isLoading=!1);{if(this.loginForm.invalid)return void(this.isLoading=!1);this.isLoading=!0;let r="";this.errorMessage="",this.hasError=!1;const t=this.formControl.mobileNo.value,h=this.formControl.password.value;this.oAuthService.oidc=!1,this.loginDto.userName=t,this.loginDto.email="",this.loginDto.password=h,this.loginDto.rememberMe=!1;try{this.appAuthService.isLoadingSubject.next(!0),this.oAuthService.fetchTokenUsingPasswordFlowAndLoadUserProfile(t,h).then(g=>{g&&(this.appAuthService.createUserModel(g),t.split("@"),this.authService.loginByUserDto(this.loginDto).subscribe(s=>{"Doctor"==s.roleName[0]?s.success?(this.isLoading=!1,this.subs.sink=this.doctorProfileService.getByUserName(s.userName?s.userName:"").subscribe(a=>{let C={identityNumber:a.identityNumber,doctorName:a.fullName,bmdcRegNo:a.bmdcRegNo,isActive:a.isActive,userId:a.userId,id:a.id,specialityId:a.specialityId,profileStep:a.profileStep,createFrom:a.createFrom,userType:s.roleName.toString().toLowerCase()};this.NormalAuth.setAuthInfoInLocalStorage(C),r=1==a.profileStep||2==a.profileStep?"/signup":a.isActive?s.roleName.toString()+"/dashboard":s.roleName.toString()+"/profile-settings/basic-info",this._router.navigate([r.toLowerCase()],{state:{data:a}}).then(F=>{this.ToasterService.customToast(s.message?s.message:" ","success")})})):(this.isLoading=!1,this.hasError=!0,this.ToasterService.customToast(s.message?s.message:" ","error")):"Patient"==s.roleName[0]?s.success?(this.isLoading=!1,this.subs.sink=this.PatientProfileService.getByUserName(s.userName?s.userName:"").subscribe(a=>{console.log(a);let C={userId:a.userId,id:a.id,userType:s.roleName.toString().toLowerCase()};this.NormalAuth.setAuthInfoInLocalStorage(C);let F=s.roleName.toString()+"/dashboard";this._router.navigate([F.toLowerCase()],{state:{data:a}}).then(J=>{this.ToasterService.customToast(s.message?s.message:" ","success")})})):(this.isLoading=!1,this.hasError=!0,this.ToasterService.customToast(s.message?s.message:" ","error")):(this.isLoading=!1,this.ToasterService.customToast(s.message?s.message:" ","error"))}))})}catch(g){this.isLoading=!1,this.hasError=!0,"'tokenEndpoint' should not be null"===g.message&&(this.errorMessage="Identity server is not running")}}}ngOnDestroy(){this.subs.unsubscribe()}}return o.\u0275fac=function(r){return new(r||o)(e.Y36(c.V),e.Y36(I),e.Y36(y.Ct),e.Y36(S.K),e.Y36(L.j),e.Y36(l.qu),e.Y36(w.F0),e.Y36(M.G),e.Y36(_.e))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-login"]],decls:34,vars:13,consts:[[1,"signup-form"],[1,"signup-form__left"],["src","../../../../assets/auth/Repeat Grid 3.png","alt","auth"],[1,"signup-form__right","drop-shadow-soft","relative"],[1,"max-w-lg","min-w-[500px]","mx-auto","mt-10","bg-white","p-8","rounded-xl","shadow","shadow-slate-300"],[1,"text-4xl","font-medium"],[1,"text-slate-500","mt-2"],["action","",1,"mt-6",3,"formGroup"],[1,"flex","flex-col","space-y-5","mt-10"],["for","mobile"],[1,"font-medium","text-slate-700","pb-2"],["type","tel","formControlName","mobileNo","type","number","id","mobileNo","placeholder","018-000-00000","required","",1,"form_input",3,"ngClass"],[3,"ngClass"],["for","Password"],["formControlName","password","type","password","name","password","id","password","placeholder","Password123@*",1,"form_input",3,"ngClass"],[1,"form_btn",3,"click"],["class","flex",4,"ngIf"],["class","loading loading-dots loading-md",4,"ngIf"],[1,"text-center"],["routerLink","/signup",1,"text-primary","font-medium","inline-flex","space-x-1","items-center"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","d","M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"],[1,"flex"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor","stroke-width","2",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","d","M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"],[1,"loading","loading-dots","loading-md"]],template:function(r,t){if(1&r&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"img",2),e.qZA(),e.TgZ(3,"div",3)(4,"div",4)(5,"h1",5),e._uU(6,"Login"),e.qZA(),e.TgZ(7,"p",6),e._uU(8,"Hi, Welcome to SoowGood \u{1f44b}"),e.qZA(),e.TgZ(9,"form",7)(10,"div",8)(11,"label",9)(12,"p",10),e._uU(13,"Mobile Number"),e.qZA(),e._UZ(14,"input",11),e.qZA(),e.TgZ(15,"p",12),e._uU(16),e.qZA(),e.TgZ(17,"label",13)(18,"p",10),e._uU(19," Password"),e.qZA(),e._UZ(20,"input",14),e.qZA(),e.TgZ(21,"p",12),e._uU(22),e.qZA(),e.TgZ(23,"button",15),e.NdJ("click",function(){return t.onSubmit()}),e.YNc(24,P,5,0,"div",16),e.YNc(25,j,1,0,"span",17),e.qZA(),e.TgZ(26,"p",18),e._uU(27," Don't have an account? "),e.TgZ(28,"a",19)(29,"span"),e._uU(30,"Sign up "),e.qZA(),e.TgZ(31,"span"),e.O4$(),e.TgZ(32,"svg",20),e._UZ(33,"path",21),e.qZA()()()()()()()()()),2&r){let h,f,g,p,v,s;e.xp6(9),e.Q6J("formGroup",t.loginForm),e.xp6(5),e.Q6J("ngClass",e.VKq(9,N,(null==(h=t.loginForm.get("mobileNo"))?null:h.invalid)&&(null==(h=t.loginForm.get("mobileNo"))?null:h.touched))),e.xp6(1),e.Q6J("ngClass",null!=(f=t.loginForm.get("mobileNo"))&&f.invalid||null!=(f=t.loginForm.get("mobileNo"))&&f.touched?"text-red-500 !mt-0 text-sm":"hidden"),e.xp6(1),e.Oqu(null!=(g=t.loginForm.get("mobileNo"))&&g.invalid&&null!=(g=t.loginForm.get("mobileNo"))&&g.touched?"Mobile number is required!":""),e.xp6(4),e.Q6J("ngClass",e.VKq(11,N,(null==(p=t.loginForm.get("password"))?null:p.invalid)&&(null==(p=t.loginForm.get("password"))?null:p.touched))),e.xp6(1),e.Q6J("ngClass",null!=(v=t.loginForm.get("password"))&&v.invalid&&null!=(v=t.loginForm.get("password"))&&v.touched?"text-red-500 !mt-0 text-sm":"hidden"),e.xp6(1),e.Oqu(null!=(s=t.loginForm.get("password"))&&s.invalid&&null!=(s=t.loginForm.get("password"))&&s.touched?"Password is required!":""),e.xp6(2),e.Q6J("ngIf",!t.isLoading),e.xp6(1),e.Q6J("ngIf",t.isLoading)}},dependencies:[m.mk,m.O5,w.rH,l._Y,l.Fj,l.wV,l.JJ,l.JL,l.Q7,l.sg,l.u],styles:[".signup-form__left[_ngcontent-%COMP%]{width:49.3%;height:100%}.signup-form__left[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}"]}),o})()}];let E=(()=>{class o{}return o.\u0275fac=function(r){return new(r||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,w.Bz.forChild(O),l.u5,l.UX]}),o})()},2381:(U,b,n)=>{n.d(b,{G:()=>d});var m=n(4650),l=n(9094);let d=(()=>{class u{constructor(c){this.toasterService=c}customToast(c,S){return this.toasterService[S](c,this.getToastOptions(S))}getToastOptions(c){const S=this.getBackgroundColor(c);return{duration:3e3,style:{padding:"10px 16px",color:this.getTextColor(c),background:S},iconTheme:this.getIconColor(c)}}getBackgroundColor(c){switch(c){case"success":return"rgb(0 171 7 / 100%)";case"error":return"rgb(255 0 0 / 100%) ";case"warning":return"rgb(255 179 68 / 100%)";default:return"#c2e0c6"}}getTextColor(c){switch(c){case"success":case"error":return"#f1f1f1";case"warning":return"#7a5600";default:return"#333"}}getIconColor(c){switch(c){case"success":default:return{primary:"#005539",secondary:"#f1f1f1"};case"error":return{primary:"#f44336",secondary:"#f1f1f1"};case"warning":return{primary:"#483500",secondary:"#f1f1f1"}}}}return u.\u0275fac=function(c){return new(c||u)(m.LFG(l.jE))},u.\u0275prov=m.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},6240:(U,b,n)=>{n.d(b,{Y:()=>l});var l=function(){function d(){this._subs=[]}return d.prototype.add=function(){for(var u=[],e=0;e<arguments.length;e++)u[e]=arguments[e];this._subs=this._subs.concat(u)},Object.defineProperty(d.prototype,"sink",{set:function(u){this._subs.push(u)},enumerable:!0,configurable:!0}),d.prototype.unsubscribe=function(){this._subs.forEach(function(u){return u&&function(d){return"function"==typeof d}(u.unsubscribe)&&u.unsubscribe()}),this._subs=[]},d}()}}]);